let allContent=null,allResults=[];const RESULTS_PER_PAGE=10,RAW_BASE_URL="/bros-unblocked/",BASE_URL=RAW_BASE_URL.endsWith("/")?RAW_BASE_URL:RAW_BASE_URL+"/",DEBOUNCE_DELAY=300,BUILD_VERSION=document&&document.body&&document.body.dataset&&document.body.dataset.build||"0";function debounce(e,t){let n;return function(...r){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n);try{e(...r)}catch(e){console.error("Debounced function error:",e)}},t)}}function showError(e,t){if(!t)return;const n=document.createElement("div");n.className="error-message",n.style.cssText="\n    padding: 16px;\n    background: #fee;\n    border: 2px solid #fcc;\n    border-radius: 8px;\n    color: #c33;\n    margin: 20px 0;\n    text-align: center;\n    font-weight: 600;\n  ",n.textContent=String(e||"An error occurred"),t.innerHTML="",t.appendChild(n)}function showLoading(e){e&&(e.innerHTML='\n    <div class="loading-spinner" style="text-align: center; padding: 40px;">\n      <div style="font-size: 48px; animation: spin 1s linear infinite;">üéÆ</div>\n      <p style="color: #666; margin-top: 16px;">Loading games...</p>\n    </div>\n  ')}const isArray=Array.isArray,isNonEmptyString=e=>"string"==typeof e&&e.length>0;async function loadContent(){if(allContent)return!0;const e="undefined"!=typeof AbortController?new AbortController:null,t=e?setTimeout(()=>e.abort(),8e3):null;try{const t=`${BASE_URL}content.json?v=${encodeURIComponent(BUILD_VERSION)}`,n=await fetch(t,{signal:e?e.signal:void 0});if(!n||!n.ok)throw new Error(`HTTP error! status: ${n&&n.status}`);const r=await n.json();if(!(r&&isArray(r.games)&&isArray(r.pages)&&isArray(r.categories)))throw new Error("Invalid content structure");return allContent=r,!0}catch(e){return console.error("Failed to load content:",e),allContent=null,!1}finally{t&&clearTimeout(t)}}function searchContent(e){if(!allContent||!isNonEmptyString(e)||!e.trim())return[];const t=e.toLowerCase(),n=[];return isArray(allContent.games)&&allContent.games.forEach(e=>{if(!e||!isNonEmptyString(e.title))return;const r=(e.title.toLowerCase().includes(t)?10:0)+(e.description&&e.description.toLowerCase().includes(t)?5:0)+(isArray(e.tags)&&e.tags.some(e=>isNonEmptyString(e)&&e.toLowerCase().includes(t))?3:0);r>0&&n.push({type:"game",score:r,...e})}),isArray(allContent.pages)&&allContent.pages.forEach(e=>{if(!e||!isNonEmptyString(e.title))return;const r=(e.title.toLowerCase().includes(t)?10:0)+(e.content&&e.content.toLowerCase().includes(t)?5:0);r>0&&n.push({type:"page",score:r,...e})}),isArray(allContent.categories)&&allContent.categories.forEach(e=>{if(!e||!isNonEmptyString(e.name))return;const r=(e.name.toLowerCase().includes(t)?10:0)+(e.description&&e.description.toLowerCase().includes(t)?5:0);r>0&&n.push({type:"category",score:r,...e})}),n.sort((e,t)=>t.score-e.score)}function formatResult(e){if(!e||"object"!=typeof e)return"üìå Untitled";return`${{game:"üéÆ",page:"üìÑ",category:"üè∑Ô∏è"}[e.type]||"üìå"} ${isNonEmptyString(e.title)?e.title:isNonEmptyString(e.name)?e.name:"Untitled"}`}function getResultLink(e){if(!e||!isNonEmptyString(e.slug))return"#";const t=encodeURIComponent(String(e.slug).trim());switch(e.type){case"game":return`${BASE_URL}games/${t}/`;case"page":return`${BASE_URL}${t}/`;case"category":return`${BASE_URL}category/${t}/`;default:return"#"}}function getQueryParam(e){if("undefined"==typeof URLSearchParams)return null;try{return new URLSearchParams(window.location.search||"").get(e)}catch{return null}}const handleSearchInput=debounce(async(e,t)=>{if(!t)return;if(!isNonEmptyString(e)||!e.trim())return t.innerHTML="",void t.classList.remove("active");const n=searchContent(e).slice(0,5);if(0===n.length)return t.innerHTML='<div class="no-results">No results found üò¢</div>',void t.classList.add("active");const r=n.map(e=>`\n    <a href="${getResultLink(e)}" class="search-result search-result-${e.type}">\n      ${formatResult(e)}\n    </a>`).join("");t.innerHTML=r,t.classList.add("active")},300);async function initHeaderSearch(){const e=document.getElementById("searchInput"),t=document.getElementById("searchDropdown");if(!e||!t)return;await loadContent()?(e.addEventListener("input",e=>{handleSearchInput(e&&e.target&&e.target.value||"",t)}),e.addEventListener("keydown",e=>{if(e&&"Enter"===e.key){e.preventDefault();const t=e.target&&e.target.value&&e.target.value.trim()||"";t&&(window.location.href=`${BASE_URL}search/?q=${encodeURIComponent(t)}`)}}),document.addEventListener("click",e=>{e.target.closest&&e.target.closest(".search-container")||t.classList.remove("active")}),document.addEventListener("keydown",n=>{n&&"Escape"===n.key&&(t.classList.remove("active"),e.blur())})):console.error("Failed to initialize search - content not loaded")}function renderResults(e=1){const t=document.getElementById("searchResults");if(!t)return;const n=Math.max(1,Math.ceil((allResults&&allResults.length?allResults.length:0)/10)),r=Math.min(Math.max(parseInt(e,10)||1,1),n),o=10*(r-1),a=(allResults||[]).slice(o,o+10);if(0===a.length){t.innerHTML='\n      <div class="no-results">\n        <p style="font-size: 48px; margin-bottom: 16px;">üò¢</p>\n        <p>No results found. Try a different search term!</p>\n      </div>\n    ';const e=document.getElementById("pagination");return void(e&&(e.innerHTML=""))}const s=a.map(e=>`\n    <div class="search-result-card search-result-${e.type}">\n      <a href="${getResultLink(e)}">\n        <h3>${formatResult(e)}</h3>\n        <p>${e.description||e.content||"No description available"}</p>\n      </a>\n    </div>`).join("");t.innerHTML=s,renderPagination(r,n);try{t.scrollIntoView({behavior:"smooth",block:"start"})}catch{}}function renderPagination(e,t){const n=document.getElementById("pagination");if(!n)return;if(!Number.isFinite(e)||!Number.isFinite(t)||t<=1)return void(n.innerHTML="");let r="";e>1&&(r+=`<a href="#" data-page="${e-1}" class="pagination-btn">‚Üê Previous</a>`);for(let n=1;n<=t;n++)1===n||n===t||n>=e-2&&n<=e+2?r+=n===e?`<span class="current">${n}</span>`:`<a href="#" data-page="${n}" class="pagination-btn">${n}</a>`:n!==e-3&&n!==e+3||(r+="<span>...</span>");e<t&&(r+=`<a href="#" data-page="${e+1}" class="pagination-btn">Next ‚Üí</a>`),n.innerHTML=r,n.addEventListener("click",e=>{const t=e.target.closest&&e.target.closest(".pagination-btn");if(!t)return;e.preventDefault();const n=t.getAttribute("data-page"),r=parseInt(n,10);Number.isNaN(r)||renderResults(r)},{once:!0})}async function initSearchPageResults(){const e=document.getElementById("searchResults"),t=document.getElementById("searchPageInput");if(!e)return;showLoading(e);if(!await loadContent())return void showError("Failed to load search content. Please try again later.",e);const n=getQueryParam("q");if(isNonEmptyString(n)){t&&(t.value=n),allResults=searchContent(n),renderResults(1);try{document.title=`Search: "${n}" | Bros Unblocked`}catch{}}else e.innerHTML='\n      <div class="no-results">\n        <p style="font-size: 48px; margin-bottom: 16px;">üîç</p>\n        <p>Enter a search term to find games, pages, and categories!</p>\n      </div>\n    ';t&&t.addEventListener("keydown",e=>{if(e&&"Enter"===e.key){e.preventDefault();const t=e.target&&e.target.value&&e.target.value.trim()||"";t&&(window.location.href=`${BASE_URL}search/?q=${encodeURIComponent(t)}`)}})}function initMobileMenu(){const e=document.querySelector(".mobile-menu-toggle"),t=document.querySelector(".main-nav");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active")}),document.addEventListener("click",n=>{n.target.closest&&n.target.closest(".header-main")||(t.classList.remove("active"),e.classList.remove("active"))}))}function initLazyLoading(){if("IntersectionObserver"in window){const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n&&n.dataset&&n.dataset.src&&(n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n))}})});document.querySelectorAll("img[data-src]").forEach(t=>{e.observe(t)})}else document.querySelectorAll("img[data-src]").forEach(e=>{e&&e.dataset&&e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"))})}function trackGamePlay(e){console.log(`Game played: ${String(e||"").slice(0,200)}`)}document.addEventListener("DOMContentLoaded",()=>{try{console.log("üéÆ Bros Unblocked - Initializing..."),initHeaderSearch(),document.getElementById("searchResults")&&initSearchPageResults(),initMobileMenu(),initLazyLoading(),console.log("‚úÖ Bros Unblocked - Ready!")}catch(e){console.error("Initialization error:",e)}}),window.addEventListener("error",e=>{console.error("Global error:",e&&(e.error||e.message||e))}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e&&(e.reason||e))}),(()=>{try{const e=document.createElement("style");e.textContent="\n      @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    ",(document.head||document.documentElement).appendChild(e)}catch{}})(),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("contact-form");if(!e)return;const t=document.getElementById("form-status"),n=e.querySelector(".submit-btn"),r=document.getElementById("issue-type"),o=document.getElementById("game-select-group"),a=document.getElementById("game");t&&n&&r&&o&&a||console.warn("Contact form: missing expected elements"),r&&o&&a&&r.addEventListener("change",function(){"Game Bug Report"===(this&&this.value)?(o.style.display="block",a.required=!0):(o.style.display="none",a.required=!1,a.value="")}),e.addEventListener("submit",async function(r){if(r.preventDefault(),n&&t){n.disabled=!0,n.textContent="Sending...",t.style.display="none",t.className="";try{const n=new FormData(e),r=e.getAttribute("action");if(!isNonEmptyString(r))throw new Error("Form action is not defined");const s="undefined"!=typeof AbortController?new AbortController:null,i=s?setTimeout(()=>s.abort(),1e4):null,c=await fetch(r,{method:"POST",body:n,headers:{Accept:"application/json"},signal:s?s.signal:void 0});if(i&&clearTimeout(i),!c||!c.ok){const e=c?c.status:"no-response";throw new Error(`Form submission failed (${e})`)}t.textContent="Thanks for your message! We'll get back to you soon.",t.className="success",e.reset(),o&&a&&(o.style.display="none",a.required=!1)}catch(e){t.textContent="Oops! Something went wrong. Please try again.",t.className="error",console.error("Contact form error:",e)}finally{n&&(n.disabled=!1,n.textContent="Send Message"),t&&(t.style.display="block")}}})});